<h4>Score : <span id="score"></span></h4>
<canvas id="container" width="300" height="300"></canvas>
<script>

    x=y=150;
    s=w=h=10;
    ys=xs=0;
    fx=fy=null;
    trails = [];
    score=0;


    window.onload = function () {
        canvas = document.getElementById('container');
        scoreLabel = document.getElementById("score");
        ctx = canvas.getContext('2d');


        interval = window.setInterval(game, 100); // start animation
        window.addEventListener('keydown', move); // handle event keyboard pressed
    };
    
    function game() {
        drawCanvas();
        drawSnake();
        drawFood();
    }

    function drawCanvas() {
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function drawSnake() {
        x += xs;
        y += ys;

        if (y < 0) { // hit the upper wall
            y = canvas.height - h;
        } else if (y >= canvas.height) { // hit the bottom wall
            y = 0;
        }

        if (x < 0) { // hit the lef wall
            x = canvas.width - w;
        } else if (x >= canvas.width) { // hit the right wall
            x = 0;
        }

        /**
         * head
         */
        trails.unshift({'x' : x, 'y' : y});

        /**
         * add new tail tail if snake eat the food
         */
        if (checkIfEatTheFood()) {
            if (xs > 0) { // current flow to the right
                trails.push({'x' : x - (trails.length * w), 'y' : y}); // add new tail to the left
            } else if (xs < 0) { // current flow to the left
                trails.push({'x' : x + (trails.length * w), 'y' : y}); // add new tail to the right
            } else if (ys > 0) { // current flow to the bottom
                trails.push({'x' : x, 'y' : y - (trails.length * h)}); // add new tail to the top
            } else if (ys < 0) { // current flow to the top
                trails.push({'x' : x, 'y' : y + (trails.length * h)}); // add new tail to the bottom
            }
        }

        ctx.fillStyle = 'green';

        for (var i in trails) {
            isHitTrail(i);
            ctx.fillRect(trails[i].x, trails[i].y, w, h);
        }

        trails.pop();
    }

    function isHitTrail(i) {
        if (trails.length > 1 // snake length greater than 1
            && i > 0 // is not the head it self
            && trails[i].x === x && trails[i].y === y // position trail equal to the head
        ) {
            /**
             * end animation
             */
            clearInterval(interval);

            ctx.fillStyle = 'red';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawsmileEndGame();

            return true;
        }

        return false;
    }

    function drawsmileEndGame() {
        ctx.beginPath();
        ctx.arc(75, 75, 50, 0, Math.PI * 2, true); // Outer circle
        ctx.moveTo(110, 75);
        ctx.arc(75, 75, 35, 0, Math.PI, false);  // Mouth (clockwise)
        ctx.moveTo(65, 65);
        ctx.arc(60, 65, 5, 0, Math.PI * 2, true);  // Left eye
        ctx.moveTo(95, 65);
        ctx.arc(90, 65, 5, 0, Math.PI * 2, true);  // Right eye
        ctx.stroke();
    }

    function checkIfEatTheFood() {
        scoreLabel.innerHTML = score;

        if (x === fx && y === fy) {
            drawFood(true);
            score++;
            return true;
        }

        return false;
    }

    function drawFood(doRandom) {
        doRandom = typeof doRandom === 'undefined' ? false : doRandom;

        ctx.fillStyle = 'red';
        if (doRandom || fx === null) {
            fx = Math.floor(Math.floor(Math.random() * canvas.width) / s) * s; // random position mod s must be equal to 0
        }
        if (doRandom || fy === null) {
            fy = Math.floor(Math.floor(Math.random() * canvas.height) / s) * s;
        }
        ctx.fillRect(fx, fy, w, h);
    }


    function move(e) {
        switch (e.keyCode) {
            case 38: //up
                xs = 0;
                ys = ys !== 0 ? ys : -1 * s;
                break;
            case 40: //down
                xs = 0;
                ys = ys !== 0 ? ys : s;
                break;
            case 37: //left
                ys = 0;
                xs = xs !== 0 ? xs : -1 * s;
                break;
            case 39: //right
                ys = 0;
                xs = xs !== 0 ? xs : s;
                break;
            case 32: //space
                xs=ys = 0;
                break;
        }
    }
</script>