<canvas id="container" width="300" height="300"></canvas>
<script>

    x=y=150;
    s=w=h=10;
    ys=xs=0;
    fx=fy=null;
    trails = [];

    window.onload = function () {
        canvas = document.getElementById('container');
        ctx = canvas.getContext('2d');
        window.setInterval(game, 100);
        window.addEventListener('keydown', move);
    };
    
    function game() {
        drawCanvas();
        drawSnake();
        drawFood();
    }

    function drawCanvas() {
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function drawSnake() {
        x = x + xs;
        y = y + ys;

        if (y < 0) { // hit the upper wall
            y = canvas.height;
        } else if (y > canvas.height) { // hit the bottom wall
            y = 0;
        }

        if (x < 0) { // hit the lef wall
            x = canvas.width;
        } else if (x > canvas.width) { // hit the right wall
            x = 0;
        }

        trails.unshift({'x' : x, 'y' : y});

        if (checkIfEatTheFood()) {
            if (xs > 0) { // current flow to the right
                trails.push({'x' : x - (trails.length * w), 'y' : y});
            } else if (xs < 0) { // current flow to the left
                trails.push({'x' : x + (trails.length * w), 'y' : y});
            } else if (ys > 0) { // current flow to the bottom
                trails.push({'x' : x, 'y' : y - (trails.length * h)});
            } else if (ys < 0) { // current flow to the top
                trails.push({'x' : x, 'y' : y + (trails.length * h)});
            }
        }

        ctx.fillStyle = 'green';

        for (var i in trails) {
            ctx.fillRect(trails[i].x, trails[i].y, w, h);
        }

        trails.pop();
    }

    function checkIfEatTheFood() {
        if (x === fx && y === fy) {
            drawFood(true);
            console.log('nyum.. nyum');
            return true;
        }

        return false;
    }

    function drawFood(doRandom) {
        doRandom = typeof doRandom === 'undefined' ? false : doRandom;

        ctx.fillStyle = 'red';
        if (doRandom || fx === null) {
            fx = Math.floor(Math.floor(Math.random() * canvas.width) / s) * s;
        }
        if (doRandom || fy === null) {
            fy = Math.floor(Math.floor(Math.random() * canvas.height) / s) * s;
        }
        ctx.fillRect(fx, fy, w, h);
    }


    function move(e) {
        switch (e.keyCode) {
            case 38: //up
                xs = 0;
                ys = ys !== 0 ? ys : -1 * s;
                break;
            case 40: //down
                xs = 0;
                ys = ys !== 0 ? ys : s;
                break;
            case 37: //left
                ys = 0;
                xs = xs !== 0 ? xs : -1 * s;
                break;
            case 39: //right
                ys = 0;
                xs = xs !== 0 ? xs : s;
                break;
            case 32: //right
                xs=ys = 0;
                break;
        }
    }
</script>